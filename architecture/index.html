
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href=".." rel="prev"/>
<link href="../tutorials/deploy-backend/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.40" name="generator"/>
<title>Architecture - TinyMotion Backend</title>
<link href="../assets/stylesheets/main.8c3ca2c6.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#architecture">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="TinyMotion Backend" class="md-header__button md-logo" data-md-component="logo" href=".." title="TinyMotion Backend">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            TinyMotion Backend
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Architecture
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/neuromechanics-uoa/tinymotion_backend" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    tinymotion_backend
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="TinyMotion Backend" class="md-nav__button md-logo" data-md-component="logo" href=".." title="TinyMotion Backend">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    TinyMotion Backend
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/neuromechanics-uoa/tinymotion_backend" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    tinymotion_backend
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Architecture
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Architecture
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api">
<span class="md-ellipsis">
      API
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication">
<span class="md-ellipsis">
      Authentication
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#administration">
<span class="md-ellipsis">
      Administration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#database">
<span class="md-ellipsis">
      Database
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#video-files">
<span class="md-ellipsis">
      Video files
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#secrets-management">
<span class="md-ellipsis">
      Secrets management
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Tutorials
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../tutorials/deploy-backend/">
<span class="md-ellipsis">
    Deploying the backend
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tutorials/creating-users-via-cli/">
<span class="md-ellipsis">
    Creating a user via the command line interface
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/cli/">
<span class="md-ellipsis">
    CLI Reference
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api">
<span class="md-ellipsis">
      API
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication">
<span class="md-ellipsis">
      Authentication
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#administration">
<span class="md-ellipsis">
      Administration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#database">
<span class="md-ellipsis">
      Database
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#video-files">
<span class="md-ellipsis">
      Video files
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#secrets-management">
<span class="md-ellipsis">
      Secrets management
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="architecture">Architecture</h1>
<h2 id="overview">Overview</h2>
<p>The backend is written in Python using:</p>
<ul>
<li>the <a href="https://fastapi.tiangolo.com/">FastAPI</a> framework</li>
<li><a href="https://docs.pydantic.dev/latest/">Pydantic</a> and <a href="https://www.sqlalchemy.org/">SQLAlchemy</a> (via <a href="https://sqlmodel.tiangolo.com/">SQLModel</a>)</li>
<li><a href="https://click.palletsprojects.com/">click</a> for the command line interface</li>
<li><a href="https://www.sqlite.org/">SQLite</a> database</li>
<li><a href="https://docs.pytest.org/">pytest</a> for testing</li>
<li><a href="https://www.mkdocs.org/">mkdocs</a> for documentation</li>
</ul>
<p>Deployment is achieved using <a href="https://www.terraform.io/">Terraform</a> and <a href="https://www.ansible.com/">Ansible</a> to create and configure a VM on an OpenStack cloud (<a href="https://support.cloud.nesi.org.nz/">NeSI RDC</a>). The TinyMotion backend software is containerised using docker and run using <a href="https://docs.docker.com/compose/">Docker compose</a>. <a href="https://docs.linuxserver.io/general/swag/">SWAG</a> (secure web access gateway) is used in front of the API and handles generating SSL certificates. <a href="https://infisical.com/docs/documentation/getting-started/introduction">Infisical</a> is used for secrets management during deployment and while launching the app.</p>
<h2 id="api">API</h2>
<p>The API provides endpoints to authenticate, create an infant, create a consent and upload a video. There are no endpoints to retrieve information in the initial version of the API.</p>
<p>An infant must be created first. Once an infant has been created a consent must be created for that infant. The consent is linked to the infant by NHI number. Once a consent has been created, videos can be created for the infant. Videos are linked to an infant by NHI number. The API will return errors in the following cases (not exclusive, see also API docs TODO):</p>
<ul>
<li>a consent is added with an NHI number that does not match an infant in the database</li>
<li>a video is added with an NHI number that does not match an infant in the database</li>
<li>a video is added for an infant that has no consent recorded in the database</li>
</ul>
<p>The API should be assumed to be case sensitive unless otherwise mentioned (i.e. the case in the NHI number should match when making subsequent calls to the API with the same NHI number).</p>
<h2 id="authentication">Authentication</h2>
<p>An access key is created for each user and shared with them. The access key is entered into the app and an API endpoint called to exchange the access key for access and refresh JWT tokens. The access token is passed in the Authorization header with subsequent API requests. If the access token expires, the refresh token can be used to generate a new access token. If the refresh token expires the access key must be entered again. The lifetimes of the access and refresh tokens are configurable.</p>
<p>Initially, all users of the app will be treated the same (authorisation). All users will be able to upload (POST) information via the API. There are no API endpoints to retrieve information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This approach to authentication was chosen as a compromise between security and ease of use for the early access users of the app.</p>
</div>
<h2 id="administration">Administration</h2>
<p>Administration (e.g. creating/updating users, accessing videos and information in the database) is done through SSH and a <a href="../reference/cli/">command line interface</a>. SSH to the VM is by public key only.</p>
<h2 id="database">Database</h2>
<p>The initial version uses an SQLite database with the following structure:</p>
<pre class="mermaid"><code>erDiagram
    USER {
        UUID user_id PK
        string email "Must be unique; encrypted"
        string access_key "Must be unique; encrypted"
        boolean disabled
    }

    INFANT {
        UUID infant_id PK
        string nhi_number "Must be unique; encrypted"
        string full_name "Encrypted"
        date birth_date "Encrypted"
        date due_date "Encrypted"
        datetime created_at
        UUID created_by FK
    }

    CONSENT {
        UUID consent_id PK
        string consent_giver_name "Can be null if consent collected physically; encrypted"
        string consent_giver_email "Can be null if consent collected physically; encrypted"
        boolean collected_physically
        UUID infant_id FK
        datetime created_at
        UUID created_by FK
    }

    VIDEO {
        UUID video_id PK
        UUID infant_id FK
        string video_name "Name of stored video, a randomly generated UUID"
        int video_size "Size of the encrypted video in bytes"
        string sha256sum "SHA-256 checksum of the original video"
        string sha256sum_enc "SHA-256 checksum of the encrypted video"
        datetime created_at
        UUID created_by FK
    }

    INFANT ||--o{ CONSENT : "is covered by"
    INFANT ||--o{ VIDEO : "features in"
    USER ||--o{ CONSENT : creates
    USER ||--o{ VIDEO : creates
    USER ||--o{ INFANT : creates

</code></pre>
<p>Fields marked as encrypted are encrypted at rest using <code>StringEncryptedType</code> (symmetric encryption) from <a href="https://sqlalchemy-utils.readthedocs.io/en/latest/data_types.html">SQLAlchemy-Utils</a>.</p>
<p>Database backups can be achieved by copying the SQLite database file. Encrypted information in the backups will not be understandable without the secret key that was used to encrypt them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SQLite should be sufficient while running at a small scale, and is good for speed of development, but could be worth considering switching to another database engine, such as PostgreSQL, when scaling up. This should be relatively simple as the database engine is abstracted away by SQLAlchemy.</p>
</div>
<h2 id="video-files">Video files</h2>
<p>Video files are encrypted as they are received and written to disk on the VM in encrypted form only. Videos are encrypted using <a href="https://cryptography.io/en/latest/fernet/">Fernet</a> (symmetric encryption, i.e. requiring the same secret key to decrypt them as was used to encrypt them). Encrypted video files are approximately 1/3 bigger than the unencrypted version would be. Video file names on disk are randomly generated UUIDs, these names are stored as <em>video_name</em> in the <em>VIDEO</em> table in the database.</p>
<p>[NOT IMPLEMENTED YET] Encrypted video files will be stored on object storage. Once they have been pushed to object storage they will be removed from VM disk.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If upload of a video file fails part way through the upload you have to start again from scratch. This may not work well, especially in areas with slow/poor connection. If this becomes an issue we may want to consider implementing resumable file upload, for example <a href="https://tus.io/">tus</a>.</p>
</div>
<h2 id="secrets-management">Secrets management</h2>
<p><a href="https://infisical.com/docs/documentation/getting-started/introduction">Infisical</a> is used for secrets management.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.525ec568.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script><script>document$.subscribe(() => {
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("redoc-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>